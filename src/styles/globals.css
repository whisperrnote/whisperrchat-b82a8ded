@tailwind base;
@tailwind components;
@tailwind utilities;

/* ==========================================================================
   TenChat Global Styles
   Purpose: Deterministic, token-driven, theme-extensible global layer.
   Flexibility: All sizing/color/typography driven by CSS custom properties.
   Modularity: Component primitives opt-in via utility classes (no leakage).
   Backwards Compatibility: Never remove or rename an existing token var;
   only add new vars with version suffix when evolving.
   ========================================================================== */

/* 1. CSS Reset (modified modern-normalize + opinionated a11y tweaks) */
*, *::before, *::after {
  box-sizing: border-box;
}
html {
  -webkit-text-size-adjust: 100%;
  font-family: var(--font-sans, 'Inter', system-ui, sans-serif);
  line-height: 1.5;
  tab-size: 2;
  text-rendering: optimizeLegibility;
  scroll-behavior: smooth;
}
body {
  margin: 0;
  min-height: 100dvh;
  background: var(--color-bg-app);
  color: var(--color-fg-primary);
  font-family: var(--font-sans, 'Inter', system-ui, sans-serif);
  font-size: var(--font-size-100);
  font-feature-settings: "ss01","cv02","cv11","kern";
  -webkit-font-smoothing: antialiased;
}
img, picture, video, canvas, svg {
  display: block;
  max-width: 100%;
}
input, button, textarea, select {
  font: inherit;
  color: inherit;
}
button {
  cursor: pointer;
  border: none;
  background: none;
}
:focus {
  outline: none;
}
:focus-visible {
  outline: 2px solid var(--color-focus-ring);
  outline-offset: 2px;
}
a {
  color: var(--color-link);
  text-decoration: none;
}
a:hover, a:focus-visible {
  text-decoration: underline;
}

/* 2. Design Token Bridge Layer
   These vars mirror ./design/tokens/tenchat.tokens.v1.json.
   Fallback values allow rendering before JS/token hydration.
   NEVER DELETE existing variables; deprecate with comment and add new. */

@layer base {
  :root {
    /* Violet Color System for TenChat */
    
    /* Dark Mode (Default) */
    --background: 240 10% 3.9%;
    --foreground: 240 5% 64.9%;
    
    --card: 240 10% 3.9%;
    --card-foreground: 240 5% 95.9%;
    
    --popover: 240 10% 3.9%;
    --popover-foreground: 240 5% 95.9%;
    
    --primary: 240 5.9% 90%;
    --primary-foreground: 240 5.9% 10%;
    
    --secondary: 240 3.7% 15.9%;
    --secondary-foreground: 240 5.9% 98%;
    
    --muted: 240 3.7% 15.9%;
    --muted-foreground: 240 5% 64.9%;
    
    --accent: 240 3.7% 15.9%;
    --accent-foreground: 240 5.9% 98%;
    
    --destructive: 0 62.8% 30.6%;
    --destructive-foreground: 0 0% 98%;
    
    --border: 240 3.7% 15.9%;
    --input: 240 3.7% 15.9%;
    --ring: 240 4.9% 83.9%;
    
    --radius: 0.5rem;
    
    /* Chat-specific colors */
    --chat-bubble-sent: 240 5.9% 90%;
    --chat-bubble-sent-foreground: 240 5.9% 10%;
    --chat-bubble-received: 240 3.7% 15.9%;
    --chat-bubble-received-foreground: 240 5.9% 98%;
    
    /* Security indicators */
    --security: 142.1 76.2% 36.3%;
    --security-foreground: 142.1 76.2% 96.3%;
    
    --warning: 47.9 95.8% 53.1%;
    --warning-foreground: 47.9 95.8% 93.1%;
    
    /* Gradients */
    --gradient-primary: linear-gradient(135deg, hsl(240 5.9% 90%), hsl(240 4.9% 83.9%));
    --gradient-security: linear-gradient(135deg, hsl(142.1 76.2% 36.3%), hsl(142.1 76.2% 56.3%));
    --gradient-bg: linear-gradient(135deg, hsl(240 10% 3.9%), hsl(240 3.7% 15.9%));
  }
  
  .dark {
    /* Same as root since dark is default */
    --background: 240 10% 3.9%;
    --foreground: 240 5% 64.9%;
    
    --card: 240 10% 3.9%;
    --card-foreground: 240 5% 95.9%;
    
    --popover: 240 10% 3.9%;
    --popover-foreground: 240 5% 95.9%;
    
    --primary: 240 5.9% 90%;
    --primary-foreground: 240 5.9% 10%;
    
    --secondary: 240 3.7% 15.9%;
    --secondary-foreground: 240 5.9% 98%;
    
    --muted: 240 3.7% 15.9%;
    --muted-foreground: 240 5% 64.9%;
    
    --accent: 240 3.7% 15.9%;
    --accent-foreground: 240 5.9% 98%;
    
    --destructive: 0 62.8% 30.6%;
    --destructive-foreground: 0 0% 98%;
    
    --border: 240 3.7% 15.9%;
    --input: 240 3.7% 15.9%;
    --ring: 240 4.9% 83.9%;
    
    /* Chat colors for dark mode */
    --chat-bubble-sent: 240 5.9% 90%;
    --chat-bubble-sent-foreground: 240 5.9% 10%;
    --chat-bubble-received: 240 3.7% 15.9%;
    --chat-bubble-received-foreground: 240 5.9% 98%;
  }
  
  .light {
    /* Light Mode */
    --background: 0 0% 100%;
    --foreground: 240 10% 3.9%;
    
    --card: 0 0% 100%;
    --card-foreground: 240 10% 3.9%;
    
    --popover: 0 0% 100%;
    --popover-foreground: 240 10% 3.9%;
    
    --primary: 240 5.9% 10%;
    --primary-foreground: 240 5.9% 98%;
    
    --secondary: 240 4.8% 95.9%;
    --secondary-foreground: 240 5.9% 10%;
    
    --muted: 240 4.8% 95.9%;
    --muted-foreground: 240 3.8% 46.1%;
    
    --accent: 240 4.8% 95.9%;
    --accent-foreground: 240 5.9% 10%;
    
    --destructive: 0 84.2% 60.2%;
    --destructive-foreground: 0 0% 98%;
    
    --border: 240 5.9% 90%;
    --input: 240 5.9% 90%;
    --ring: 240 10% 3.9%;
    
    /* Chat colors for light mode */
    --chat-bubble-sent: 240 5.9% 10%;
    --chat-bubble-sent-foreground: 240 5.9% 98%;
    --chat-bubble-received: 240 4.8% 95.9%;
    --chat-bubble-received-foreground: 240 5.9% 10%;
    
    /* Light mode gradients */
    --gradient-primary: linear-gradient(135deg, hsl(240 5.9% 10%), hsl(240 5.9% 30%));
    --gradient-bg: linear-gradient(135deg, hsl(0 0% 100%), hsl(240 4.8% 95.9%));
  }
}

/* 3. Dark / Light Mode
   The default is dark-first. Light overrides attach to [data-theme=light]. */

[data-theme="light"] {
  --color-bg-app: #f5f7fa;
  --color-bg-surface: #ffffff;
  --color-bg-soft: #f0f3f7;
  --color-bg-alt: #e9edf2;
  --color-fg-primary: #1e2430;
  --color-fg-secondary: #344156;
  --color-fg-muted: #5a6b80;
  --color-border: #d3dbe4;
  --color-border-strong: #b7c4d2;
  --color-scroll-track: #e2e8f0;
  --color-scroll-thumb: #c1ccd8;
  --color-msg-inbound-bg: #e9edf2;
  --msg-inbound-bg: #e9edf2;
  --msg-outbound-bg: linear-gradient(135deg,#4f46e5,#6366f1);
  --msg-outbound-fg: #ffffff;
  --color-focus-ring: #4338ca;
}

/* 4. Reduced Motion Support */
@media (prefers-reduced-motion: reduce) {
  * {
    animation-duration: 1ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 1ms !important;
    scroll-behavior: auto !important;
  }
}

/* 5. Utilities (Atomic-ish, stable names) */
.u-flex { display: flex; }
.u-inline-flex { display: inline-flex; }
.u-flex-col { flex-direction: column; }
.u-flex-row { flex-direction: row; }
.u-center { align-items: center; justify-content: center; }
.u-gap-xs { gap: var(--space-1); }
.u-gap-sm { gap: var(--space-2); }
.u-gap-md { gap: var(--space-4); }
.u-gap-lg { gap: var(--space-6); }
.u-scroll-y { overflow-y: auto; }
.u-hidden { display: none !important; }
.u-visually-hidden {
  position: absolute !important;
  width: 1px; height: 1px;
  padding: 0; margin: -1px;
  overflow: hidden; clip: rect(0 0 0 0);
  white-space: nowrap; border: 0;
}
.u-text-mono { font-family: var(--font-mono); }
.u-text-xs { font-size: var(--font-size-75); }
.u-text-sm { font-size: var(--font-size-90); }
.u-text-base { font-size: var(--font-size-100); }
.u-text-lg { font-size: var(--font-size-125); }
.u-text-xl { font-size: var(--font-size-150); }
.u-text-bold { font-weight: var(--font-weight-bold); }
.u-text-medium { font-weight: var(--font-weight-medium); }
.u-ellipsis {
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

/* 6. Scrollbars */
* {
  scrollbar-width: thin;
  scrollbar-color: var(--color-scroll-thumb) var(--color-scroll-track);
}
*::-webkit-scrollbar {
  width: var(--scrollbar-size);
  height: var(--scrollbar-size);
}
*::-webkit-scrollbar-track {
  background: var(--color-scroll-track);
}
*::-webkit-scrollbar-thumb {
  background: var(--color-scroll-thumb);
  border-radius: 20px;
  border: 2px solid var(--color-scroll-track);
}
*::-webkit-scrollbar-thumb:hover {
  background: var(--color-border-strong);
}

/* 7. App Layout Primitives */
.app-shell {
  display: grid;
  grid-template-columns: 320px 1fr;
  grid-template-rows: 1fr;
  height: 100dvh;
  max-width: 100%;
  background: var(--color-bg-app);
  color: var(--color-fg-primary);
}
@media (max-width: 960px) {
  .app-shell {
    grid-template-columns: 1fr;
  }
}

.sidebar {
  background: var(--color-bg-surface);
  border-right: 1px solid var(--color-border);
  display: flex;
  flex-direction: column;
  min-height: 0;
  overflow: hidden;
}

.main-pane {
  background: var(--color-bg-soft);
  display: flex;
  flex-direction: column;
  min-height: 0;
  position: relative;
}

/* 8. Conversation List */
.conversation-list {
  list-style: none;
  margin: 0;
  padding: 0;
  overflow-y: auto;
}
.conversation-item {
  display: flex;
  gap: var(--space-3);
  align-items: center;
  padding: var(--space-3) var(--space-4);
  border-bottom: 1px solid var(--color-border);
  cursor: pointer;
  background: transparent;
  transition: background var(--transition-base);
}
.conversation-item:hover,
.conversation-item[aria-selected="true"] {
  background: var(--color-bg-alt);
}
.conversation-item__avatar {
  width: 42px;
  height: 42px;
  border-radius: var(--radius-pill);
  background: var(--color-bg-alt);
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: var(--font-weight-medium);
  font-size: var(--font-size-90);
  color: var(--color-fg-secondary);
}

/* 9. Message Pane */
.messages-wrapper {
  flex: 1;
  overflow-y: auto;
  padding: var(--space-4) var(--space-6) var(--space-4) var(--space-4);
  display: flex;
  flex-direction: column;
  gap: var(--space-2);
  scrollbar-gutter: stable both-edges;
}

.message-row {
  display: flex;
  flex-direction: row;
  align-items: flex-end;
  gap: var(--space-2);
  max-width: 100%;
}
.message-row--inbound {
  justify-content: flex-start;
}
.message-row--outbound {
  justify-content: flex-end;
}

.message-bubble {
  max-width: min(72ch, 78%);
  background: var(--msg-inbound-bg);
  color: var(--msg-inbound-fg);
  padding: var(--space-2) var(--space-3);
  border-radius: var(--msg-radius);
  font-size: var(--font-size-90);
  line-height: var(--line-height-snug);
  position: relative;
  word-wrap: break-word;
  overflow-wrap: anywhere;
  hyphens: auto;
  box-shadow: var(--shadow-sm);
}
.message-bubble--outbound {
  background: var(--msg-outbound-bg);
  color: var(--msg-outbound-fg);
  box-shadow: var(--shadow-md);
}
.message-bubble__meta {
  display: flex;
  gap: var(--space-1);
  font-size: var(--font-size-50);
  opacity: 0.7;
  margin-top: var(--space-1);
}

/* 10. Composer */
.composer {
  border-top: 1px solid var(--color-border);
  background: var(--color-bg-surface);
  padding: var(--space-3) var(--space-4);
  display: flex;
  gap: var(--space-3);
  align-items: flex-end;
}
.composer textarea {
  flex: 1;
  resize: none;
  min-height: 54px;
  max-height: 220px;
  padding: var(--space-2) var(--space-3);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-3);
  background: var(--color-bg-soft);
  color: var(--color-fg-primary);
  font-size: var(--font-size-100);
  line-height: var(--line-height-normal);
  transition: border var(--transition-base), background var(--transition-base);
}
.composer textarea:focus-visible {
  border-color: var(--color-brand-500);
  background: var(--color-bg-alt);
}
.composer__actions {
  display: flex;
  gap: var(--space-2);
}
.button {
  --_btn-bg: var(--color-bg-alt);
  --_btn-fg: var(--color-fg-primary);
  --_btn-bg-hover: var(--color-bg-soft);
  --_btn-border: var(--color-border);
  font-size: var(--font-size-90);
  font-weight: var(--font-weight-medium);
  padding: var(--space-2) var(--space-4);
  background: var(--_btn-bg);
  color: var(--_btn-fg);
  border: 1px solid var(--_btn-border);
  border-radius: var(--radius-3);
  display: inline-flex;
  align-items: center;
  gap: var(--space-2);
  line-height: 1;
  transition: background var(--transition-base), border-color var(--transition-base), transform var(--transition-base);
  position: relative;
}
.button:hover {
  background: var(--_btn-bg-hover);
}
.button:active {
  transform: translateY(1px);
}
.button--primary {
  --_btn-bg: var(--color-brand-600);
  --_btn-bg-hover: var(--color-brand-500);
  --_btn-fg: #fff;
  --_btn-border: var(--color-brand-700);
}
.button--danger {
  --_btn-bg: var(--color-danger);
  --_btn-bg-hover: #f87171;
  --_btn-fg: #fff;
  --_btn-border: #b91c1c;
}
.button--ghost {
  --_btn-bg: transparent;
  --_btn-bg-hover: var(--color-bg-alt);
  --_btn-border: var(--color-border);
}

/* Loading / Pending state layering */
.is-loading {
  position: relative;
  pointer-events: none;
  opacity: 0.65;
}
.is-loading::after {
  content: "";
  position: absolute;
  inset: 0;
  background:
    repeating-linear-gradient(
      45deg,
      rgba(255,255,255,0.04) 0 10px,
      rgba(255,255,255,0.08) 10px 20px
    );
  animation: shimmer 1.2s linear infinite;
  border-radius: inherit;
}
@keyframes shimmer {
  0% { background-position: 0 0; }
  100% { background-position: 60px 60px; }
}

/* 11. Status / Pills */
.status-pill {
  display: inline-flex;
  align-items: center;
  gap: var(--space-1);
  padding: 2px 8px;
  background: var(--color-bg-alt);
  color: var(--color-fg-secondary);
  font-size: var(--font-size-50);
  border-radius: var(--radius-pill);
  line-height: 1.2;
  font-weight: var(--font-weight-medium);
}
.status-pill--online {
  background: var(--color-positive-bg);
  color: var(--color-positive);
}
.status-pill--warn {
  background: var(--color-warning-bg);
  color: var(--color-warning);
}
.status-pill--danger {
  background: var(--color-danger-bg);
  color: var(--color-danger);
}

/* 12. Toasts */
.toast-container {
  position: fixed;
  z-index: var(--z-toast);
  bottom: var(--space-6);
  right: var(--space-6);
  display: flex;
  flex-direction: column;
  gap: var(--space-2);
  max-width: 360px;
}
.toast {
  background: var(--color-bg-surface);
  border: 1px solid var(--color-border);
  padding: var(--space-3) var(--space-4);
  border-radius: var(--radius-3);
  box-shadow: var(--shadow-lg);
  font-size: var(--font-size-90);
  display: flex;
  gap: var(--space-3);
  align-items: flex-start;
  animation: toast-in var(--duration-med) var(--ease-entrance);
}
@keyframes toast-in {
  from { opacity: 0; transform: translateY(10px) scale(.98); }
  to { opacity: 1; transform: translateY(0) scale(1); }
}

/* 13. Modal / Overlay */
.modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(10,12,16,0.72);
  backdrop-filter: blur(8px);
  z-index: var(--z-modal);
  display: flex;
  align-items: center;
  justify-content: center;
  padding: var(--space-6);
  animation: fade-in var(--duration-med) var(--ease-entrance);
}
@keyframes fade-in {
  from { opacity: 0; }
  to { opacity: 1; }
}

.modal {
  background: var(--color-bg-surface);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-4);
  width: min(640px, 100%);
  max-height: 90dvh;
  display: flex;
  flex-direction: column;
  overflow: hidden;
  box-shadow: var(--shadow-lg);
}
.modal__header {
  padding: var(--space-4);
  border-bottom: 1px solid var(--color-border);
  font-size: var(--font-size-125);
  font-weight: var(--font-weight-semibold);
}
.modal__body {
  padding: var(--space-4);
  overflow-y: auto;
  flex: 1;
}
.modal__footer {
  padding: var(--space-3) var(--space-4);
  border-top: 1px solid var(--color-border);
  display: flex;
  justify-content: flex-end;
  gap: var(--space-2);
}

/* 14. Forms / Inputs */
.field {
  display: flex;
  flex-direction: column;
  gap: var(--space-1);
  margin-bottom: var(--space-4);
}
.field__label {
  font-size: var(--font-size-75);
  text-transform: uppercase;
  letter-spacing: 0.05em;
  color: var(--color-fg-muted);
  font-weight: var(--font-weight-medium);
}
.field__control {
  display: flex;
  flex-direction: column;
}
.input {
  padding: var(--space-2) var(--space-3);
  background: var(--color-bg-soft);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-2);
  color: var(--color-fg-primary);
  font-size: var(--font-size-100);
  transition: border var(--transition-base), background var(--transition-base);
}
.input:focus-visible {
  border-color: var(--color-brand-500);
  background: var(--color-bg-alt);
}
.input--invalid {
  border-color: var(--color-danger);
}
.field__hint {
  font-size: var(--font-size-75);
  color: var(--color-fg-muted);
}
.field__error {
  font-size: var(--font-size-75);
  color: var(--color-danger);
  margin-top: var(--space-1);
}

/* 15. Code / Monospace */
.code-inline {
  font-family: var(--font-mono);
  background: var(--color-bg-alt);
  padding: 2px 6px;
  border-radius: var(--radius-1);
  font-size: var(--font-size-75);
  border: 1px solid var(--color-border);
}

/* 16. Data Density Adaptation */
[data-density="compact"] {
  --space-2: 0.4rem;
  --space-3: 0.6rem;
  --space-4: 0.8rem;
  --msg-gap: var(--space-1);
  .conversation-item {
    padding: var(--space-2) var(--space-3);
  }
  .message-bubble {
    padding: var(--space-2) var(--space-2);
  }
}

/* 17. Theming API (Add custom theme tokens under data-theme="custom-*") */
[data-theme^="custom-"] {
  /* Intentionally blank extension hook. */
}

/* 18. Transitions (Generic Helpers) */
.transition-base {
  transition: all var(--transition-base);
}

/* 19. Badge */
.badge {
  display: inline-flex;
  align-items: center;
  padding: 2px 6px;
  font-size: var(--font-size-50);
  border-radius: var(--radius-pill);
  background: var(--color-bg-alt);
  color: var(--color-fg-secondary);
  line-height: 1.2;
  border: 1px solid var(--color-border);
}
.badge--brand {
  background: var(--color-brand-600);
  color: #fff;
  border-color: var(--color-brand-700);
}

/* 20. Crypto / Ledger UI Primitives */
.asset-chip {
  display: inline-flex;
  align-items: center;
  gap: var(--space-1);
  font-size: var(--font-size-75);
  padding: 2px 8px;
  border-radius: var(--radius-pill);
  background: var(--color-bg-alt);
  border: 1px solid var(--color-border);
}
.tx-row {
  display: grid;
  grid-template-columns: 1fr auto;
  gap: var(--space-2);
  padding: var(--space-3) var(--space-3);
  border-bottom: 1px solid var(--color-border);
  font-size: var(--font-size-90);
}
.tx-row--credit {
  color: var(--color-positive);
}
.tx-row--debit {
  color: var(--color-danger);
}

/* 21. Notarization Hash Display */
.hash-fragment {
  font-family: var(--font-mono);
  font-size: var(--font-size-75);
  background: var(--color-bg-alt);
  padding: 2px 4px;
  border-radius: var(--radius-1);
  letter-spacing: 0.5px;
  user-select: text;
}

/* 22. Loading Skeleton */
.skeleton {
  position: relative;
  overflow: hidden;
  background: linear-gradient(90deg,
    rgba(255,255,255,0.06) 25%,
    rgba(255,255,255,0.10) 37%,
    rgba(255,255,255,0.06) 63%);
  background-size: 400% 100%;
  animation: skeleton-loading 1.4s ease-in-out infinite;
  border-radius: var(--radius-2);
}
@keyframes skeleton-loading {
  0% { background-position: 100% 50%; }
  100% { background-position: 0 50%; }
}

/* 23. Safe Area Insets */
:root {
  --inset-top: env(safe-area-inset-top, 0px);
  --inset-right: env(safe-area-inset-right, 0px);
  --inset-bottom: env(safe-area-inset-bottom, 0px);
  --inset-left: env(safe-area-inset-left, 0px);
}
.safe-area-padded {
  padding:
    calc(var(--space-4) + var(--inset-top))
    calc(var(--space-4) + var(--inset-right))
    calc(var(--space-4) + var(--inset-bottom))
    calc(var(--space-4) + var(--inset-left));
}

/* 24. Progressive Disclosure (collapsible) */
.collapsible {
  overflow: hidden;
  transition: height var(--duration-med) var(--ease-standard), opacity var(--duration-med) var(--ease-standard);
}
.collapsible[aria-hidden="true"] {
  opacity: 0;
  height: 0 !important;
}

/* 25. Print Support */
@media print {
  .app-shell, .sidebar, .composer, .modal-overlay, .toast-container {
    box-shadow: none !important;
  }
  .button, .composer, .toast, .modal-overlay {
    display: none !important;
  }
}

/* 26. Future-Proofing Comments:
   - When adding new tokens for 2026 features, suffix them with -2026V1.
   - Avoid hard-coded colors below this line; always map to semantic vars.
   - For legacy override bridging, create a new:root[data-compat-vX] block. */

/* 27. Data Integrity Mark (Optional visual integrity watermark) */
html[data-integrity="degraded"] body::after {
  content: "INTEGRITY MODE: DEGRADED";
  position: fixed;
  bottom: 4px;
  right: 8px;
  font-size: 10px;
  padding: 4px 6px;
  background: linear-gradient(90deg,#ef4444,#f59e0b);
  color: #fff;
  border-radius: var(--radius-1);
  font-weight: 600;
  letter-spacing: .05em;
  z-index: var(--z-max);
  pointer-events: none;
  opacity: 0.85;
}

/* 28. End-of-file Marker (do not remove; used by regeneration scripts) */
/* @tenchat-globals-end */